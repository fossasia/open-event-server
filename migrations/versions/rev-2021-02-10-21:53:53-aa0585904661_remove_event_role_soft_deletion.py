"""Remove event role soft deletion

Revision ID: aa0585904661
Revises: 6b9d98ec9046
Create Date: 2021-02-10 21:53:53.144430

"""

from alembic import op
import sqlalchemy as sa
import sqlalchemy_utils
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = 'aa0585904661'
down_revision = '157df65ec235'


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute('delete from users_events_roles where deleted_at is not null')
    op.create_unique_constraint('uq_uer_user_event_role', 'users_events_roles', ['user_id', 'event_id', 'role_id'])
    op.drop_column('users_events_roles', 'deleted_at')
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('users_events_roles', sa.Column('deleted_at', postgresql.TIMESTAMP(timezone=True), autoincrement=False, nullable=True))
    op.drop_constraint('uq_uer_user_event_role', 'users_events_roles', type_='unique')
    # ### end Alembic commands ###
